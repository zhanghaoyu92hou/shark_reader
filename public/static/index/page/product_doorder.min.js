var countdown = 0;
function getCode(d) {
    if (countdown !== 0) {
        return false
    }
    countdown = 120;
    var c = /^1[3456789]\d{9}$/;
    var a = $("#phone").val();
    if (!c.test(a)) {
        countdown = 0;
        layMsg("手机号格式有误,请确认");
        return false
    }
    var b = U("Com/sendMessageCode");
    $.ajax({
        type: "post",
        url: b,
        data: {
            phone: a
        },
        dataType: "json",
        success: function(e) {
            if (e.msg === "ok") {
                settime(d)
            } else {
                countdown = 0;
                layMsg(e.msg)
            }
        },
        error: function() {
            countdown = 0;
            layMsg("网络错误,请稍后再试")
        }
    })
}
function settime(a) {
    if (countdown == 0) {
        $(a).text("发送验证码");
        return
    } else {
        $(a).text(countdown + "S");
        countdown--
    }
    setTimeout(function() {
        settime(a)
    },
    1000)
}
function doOrder() {
    var c = $("#username").val();
    if (!c) {
        layMsg("请输入收货人姓名");
        return false
    }
    var g = $("#phone").val();
    var a = /^1[3456789]\d{9}$/;
    if (!a.test(g)) {
        layMsg("手机号格式不正确");
        return false
    }
    var e = $("#verify_code").val();
    var i = /^\d{6}$/;
    if (!i.test(e)) {
        layMsg("验证码格式不规范");
        return false
    }
    var d = $("#remark").val();
    var j = $("#address").val();
    if (!j) {
        layMsg("请输入您的收货地址");
        return false
    }
    var f = $("#pcount").val();
    var b = {
        username: c,
        phone: g,
        code: e,
        remark: d,
        address: j,
        count: f,
        pid: pid
    };
    var h = U("Charge/saleOrder");
    if (h) {
        ajaxPost(h, b,
        function(k) {
            window.location.href = k.url
        })
    }
}
$(function() {
    b();
    $(window).resize(function() {
        b()
    });
    function b() {
        var c = $("body").width();
        $(".footerBook").width(c)
    }
    $(".add").click(function() {
        var d = $(this).prev().val();
        var c = parseInt(d) + 1;
        if (c == 0) {
            return
        }
        $(this).prev().val(c);
        a()
    });
    $(".jian").click(function() {
        var d = $(this).next().val();
        var c = parseInt(d) - 1;
        if (c == 0) {
            return
        }
        $(this).next().val(c);
        a()
    });
    $("#pcount").keyup(function() {
        var c = parseInt($(this).val());
        c = c > 0 ? c: 1;
        $(this).val(c);
        a()
    });
    function a() {
        var c = parseInt($("#pcount").val());
        var d = c * money;
        $("#showCount").text(c);
        $("#total_money").text(d)
    }
});