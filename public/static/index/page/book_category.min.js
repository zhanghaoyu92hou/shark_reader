$(function() {
    var b = {},
    e = 1,
    d = false;
    f();
    a();
    c();
    $(window).resize(function() {
        c()
    });
    function c() {
        var g = $("body").width();
        $(".footer").width(g - 60)
    }
    $(".classifyTag>div>a").click(function() {
        $(this).addClass("active").siblings().removeClass("active");
        e = 1;
        f();
        d = false;
        $("#searchBox").html("");
        a()
    });
    function a() {
        if (!d) {
            d = true;
            b["page"] = e;
            ajaxPost("", b,
            function(h) {
                var g = 0;
                if (h) {
                    $.each(h,
                    function(j, k) {
                        g++;
                        var l = "";
                        l += "<li>";
                        l += '<a href="javascript:;">';
                        l += '<div class="recommendPos">';
                        l += '<div class="recommendHotImg">';
                        l += '<a href="' + k.info_url + '"><img src="' + k.cover + '" alt=""></a>';
                        l += "</div>";
                        l += '<div class="recommendFont">';
                        l += '<h4 class="over">';
                        l += '<a href="' + k.info_url + '">' + k.name + "</a>";
                        l += "</h4>";
                        l += '<p class="over2 read_p">';
                        l += '<a href="' + k.info_url + '">' + k.summary + "</a>";
                        l += "</p>";
                        l += '<div class="historyTag">';
                        l += '<a href="javascript:;" class="active_lz">' + k.over_type + "</a>";
                        if (k.category) {
                            for (var j = 0; j < k.category.length; j++) {
                                l += '<a href="javascript:;">' + k.category[j] + "</a>"
                            }
                        }
                        l += "</div>";
                        l += '<div class="historyNumber">';
                        l += "<div>";
                        l += "<span>";
                        l += '<img src="/static/index/images/cartoon_ico1.jpg" alt="">';
                        l += "<em>" + k.hot_num + "</em>";
                        l += "</span>";
                        l += "<span>";
                        l += '<img src="/static/index/images/cartoon_ico2.jpg" alt="">';
                        l += "<em>" + k.total_chapter + "章</em>";
                        l += "</span>";
                        l += "</div>";
                        l += '<a class="readStar ripple" href="' + k.read_url + '">开始阅读</a>';
                        l += "</div>";
                        l += "</div>";
                        l += "</div>";
                        l += "</a>";
                        l += "</li>";
                        $("#searchBox").append(l)
                    })
                } else {
                    if (e === 1) {
                        var i = "";
                        i += "<li>";
                        i += '<div class="searchTs">';
                        i += '<img src="/static/index/images/searchBg.png" alt="">';
                        i += "<p>抱歉亲亲～</p>";
                        i += "<p>没有相关内容</p>";
                        i += "</div>";
                        i += "</li>";
                        $("#searchBox").html(i)
                    }
                }
                if (g >= 10) {
                    e++;
                    d = false
                }
            })
        }
    }
    function f() {
        var j = $(".category .active").attr("data-val");
        var i = $(".gender_type .active").attr("data-val");
        var g = $(".over_type .active").attr("data-val");
        var l = $(".free_type .active").attr("data-val");
        var h = $(".book_type").val();
        var k = {};
        if (h) {
            k["type"] = h
        }
        if (j) {
            k["category"] = j
        }
        if (i) {
            k["gender_type"] = i
        }
        if (g) {
            k["over_type"] = g
        }
        if (l) {
            k["free_type"] = l
        }
        b = k
    }
    $(window).scroll(function() {
        var h = $(this).scrollTop();
        var g = $(document).height();
        var i = $(this).height();
        if(h+i >= (g-200)){
            if (!d) {
                a()
            }
        }
    })
});