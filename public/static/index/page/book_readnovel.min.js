$(function () {
    a();
    doSetPage();
    checkCollect();
    f();
    $(window).resize(function () {
        f()
    });

    function f() {
        var g = $("body").width();
        $(".footer").width(g - 60);
        $(".menuFooterFixed").width(g);
        $(".fixedScrool").width(g)
    }
    $(".background_A").click(function () {
        $(this).addClass("active").siblings().removeClass("active");
        var g = $(this).css("background-color");
        $.cookie("read_page_color", g);
        $(".fictionCount,.commodityNav,.menuFooter,.fixedScrool").css("background-color", g);
        if ($(this).css("background-color") == "rgb(46, 47, 45)") {
            $(".tmpbody").addClass("activeFont")
        } else {
            $(".tmpbody").removeClass("activeFont")
        }
    });
    var c = 1,
        e = 1.5,
        b = 25;
    $(".font_A").click(function () {
        var g = $(".font_A").index($(this));
        if (g == 0) {
            c++;
            if (c > 4) {
                c = 4
            } else {
                e += 0.1;
                b += 5
            }
        } else {
            c--;
            if (c < 1) {
                c = 1
            } else {
                e = e - 0.1;
                b = b - 5
            }
        }
        $.cookie("read_page_size", e);
        $.cookie("read_page_line", b);
        $(".fontCount>p").css("font-size", e + "rem");
        $(".fontCount>p").css("line-height", b + "px")
    });
    var d = 0;

    function a() {
        var k = window.innerHeight;
        var i = $(window).scrollTop();
        var j = $(document).height();
        var h = $(".fixedScrool").innerHeight();
        var g = [k, i, j, h];
        return g
    }
    var readtap = 1
     $(window).click(function() {
        var g = a();
        var k = g[0];
        var i = g[1];
        var j = g[2];
        var h = g[3];
         if(readtap == 1){
             if (i + k < j) {
               $(".menuFooter").addClass("menuFooterFixed");
            }
            $(".fixedScrool").addClass("active");
            $(".fictionCount").css("marginTop", h);
             $(".chase>a").removeClass("active")
             readtap = 0
         }else{
                    $(".menuFooter").removeClass("menuFooterFixed");
                    $(".fixedScrool").removeClass("active");
                    $(".fictionCount").css("marginTop", 0);
                    $(".chase>a").removeClass("active")
                     readtap = 1
         }
     });
    $(window).scroll(function () {
        var g = a();
        var k = g[0];
        var i = g[1];
        var j = g[2];
        var h = g[3];
        if (i <= k / 10) {
            $(".height_50").hide()
        } else {
            if (i + k >= j) {
                $(".height_50").hide();
                $(".menuFooter").removeClass("menuFooterFixed")
            } else {
                if (i > d) {
                    $(".menuFooter").removeClass("menuFooterFixed");
                    $(".fixedScrool").removeClass("active");
                    $(".fictionCount").css("marginTop", 0);
                    $(".chase>a").removeClass("active")
                }
            }
        }
        d = i
    });
    $(document).on("tap", function () {
        var g = a();
        var k = g[0];
        var i = g[1];
        var j = g[2];
        var h = g[3];
        if (i + k >= j) {
            $(".height_50").hide();
            $(".menuFooter").removeClass("menuFooterFixed")
        } else {
            $(".menuFooter").addClass("menuFooterFixed");
            $(".fixedScrool").addClass("active");
            $(".fictionCount").css("marginTop", h);
            $(".chase>a").addClass("active")
        }
    })
});

function checkPrev() {
    cur_number = cur_number > 0 ? cur_number : 1;
    var b = 1;
    if (cur_number > 1) {
        b = cur_number - 1
    }
    var a = U("read");
    a += "?book_id=" + book_id + "&number=" + b;
    window.location.href = a
}

function checkNext() {
    var a = U("checkNext");
    if (a) {
        cur_number = cur_number > 0 ? cur_number : 1;
        var b = 1;
        if (cur_number > 0) {
            b = cur_number + 1
        }
        ajaxPost(a, {
            book_id: book_id,
            number: b
        }, function (c) {
            switch (c.flag) {
            case 0:
                window.location.href = c.url;
                break;
            case 1:
                layer.open({
                    content: c.msg,
                    btn: ["确定", "取消"],
                    yes: function (d) {
                        layer.close(d);
                        window.location.href = c.url
                    }
                });
                break;
            case 2:
                layer.open({
                    content: "您的书币余额不足，是否立即充值?",
                    btn: ["确定", "取消"],
                    yes: function (d) {
                        layer.close(d);
                        window.location.href = c.url
                    }
                });
                break;
            case 3:
                layer.open({
                    content: c.msg,
                    btn: ["确定", "取消"],
                    yes: function (d) {
                        layer.close(d);
                        window.location.href = c.url
                    }
                });
                break;
            case 4:
                toAttention();
                break
            }
        })
    }
}

function doCollect(b) {
    if (!$(b).hasClass("active")) {
        var a = U("Com/doCollect");
        if (a) {
            ajaxPost(a, {
                book_id: book_id
            }, function () {
                layMsg("收藏成功");
                $(b).addClass("active")
            })
        }
    }
}

function checkCollect() {
    var a = U("Com/doCheckCollect");
    if (a) {
        ajaxPost(a, {
            book_id: book_id
        }, function (b) {
            if (b.flag === 1) {
                $(".collectSc").addClass("active")
            }
        })
    }
}

function doSetPage() {
    var b = $.cookie("read_page_color");
    if (b) {
        $(".fictionCount,.commodityNav,.menuFooter,.fixedScrool").css("background-color", b);
        $(".background_A").each(function () {
            var d = $(this).css("background-color");
            if (d === b) {
                $(this).addClass("active");
                return false
            }
        });
        if (b == "rgb(46, 47, 45)") {
            $(".tmpbody").addClass("activeFont")
        } else {
            $(".tmpbody").removeClass("activeFont")
        }
    }
    var a = $.cookie("read_page_size");
    var c = $.cookie("read_page_line");
    if (a) {
        $(".fontCount>p").css("font-size", a + "rem")
    }
    if (c) {
        $(".fontCount>p").css("line-height", c + "px")
    }
}

function followBook() {
    layer.open({
        content: $(".followbook_dom").html(),
        shadeClose: false,
        className: "chaseLayer",
        style: "background-color:#fff; color:#fff; border:none;    border-radius:20px ;"
    })
}

function toAttention() {
    layer.open({
        content: $(".attention_dom").html(),
        shadeClose: false,
        className: "chaseLayer",
        style: "background-color:#fff; color:#fff; border:none;border-radius:20px ;"
    })
}

function toDir() {
    var a = U("info");
    if (a) {
        a += "?book_id=" + book_id + "&is_dir=1";
        window.location.href = a
    }
};