var page = 1,
        is_end = false;
checkCollect();
getSameBooks();
getRewardMoney();
getChapters();
getComments();
getAdvertisement();
function getAdvertisement() {
    var a = U("getAdvertisement");

    ajaxPost(a, {
        name: name
    },
            function (c) {
//        console.log(c);return false;
                if (c.list) {
                    var d = '<a style="width: 100%;height: 100px" href="' + c.list.url + '">';
                    d += '<img style="width: 100%;height: 150px" src="' + c.list.img + '"> </a>'
                    $(".advertisement").html(d);
                    $(".evaluation").show()
                }
            })
}
function getChapters() {
    if (!is_end) {
        is_end = true;
        var a = U("getBookChapter");
        if (a) {
            ajaxPost(a, {
                book_id: book_id,
                page: page
            },
                    function (c) {
                        var b = 0;
                        if (c) {
                            $.each(c,
                                    function (d, e) {
                                        b++;
                                        var f = "";
                                        if (e.money > 0) {
                                            f += '<a href="javascript:void(0);" onclick="javascript:checkChapter(' + e.number + ');"><em>' + e.name + '</em><p><img src="/static/index/images/shub.jpg" alt=""><i>' + e.money + "书币</i></p></a>"
                                        } else {
                                            f += '<a href="javascript:void(0);" onclick="javascript:checkChapter(' + e.number + ');"><em>' + e.name + "</em></a>"
                                        }
                                        $(".directory_A").append(f)
                                    })
                        }
                        if (b < 12) {
                            $(".lookMore>a").text("...我也是有底线的...")
                        } else {
                            page++;
                            is_end = false
                        }
                    })
        }
    }
}
function checkChapter(b) {
    var a = U("checkNext");
    if (a) {
        ajaxPost(a, {
            book_id: book_id,
            number: b
        },
                function (c) {
                    switch (c.flag) {
                        case 0:
                            window.location.href = c.url;
                            break;
                        case 1:
                            layer.open({
                                content:
                                        c.msg,
                                btn: ["确定", "取消"],
                                yes: function (d) {
                                    layer.close(d);
                                    window.location.href = c.url
                                }
                            });
                            break;
                        case 2:
                            layer.open({
                                content:
                                        "您的书币余额不足，是否立即充值?",
                                btn: ["确定", "取消"],
                                yes: function (d) {
                                    layer.close(d);
                                    window.location.href = c.url
                                }
                            });
                            break;
                        case 3:
                            layer.open({
                                content:
                                        c.msg,
                                btn: ["确定", "取消"],
                                yes: function (d) {
                                    layer.close(d);
                                    window.location.href = c.url
                                }
                            });
                            break;
                        case 4:
                            toAttention();
                            break
                    }
                })
    }
}
function doCollect(b) {
    if (!$(b).hasClass("active_sc")) {
        var a = U("Com/doCollect");
        if (a) {
            ajaxPost(a, {
                book_id: book_id
            },
                    function () {
                        layMsg("收藏成功");
                        $(b).addClass("active_sc")
                    })
        }
    }
}
function checkCollect() {
    var a = U("Com/doCheckCollect");
    if (a) {
        ajaxPost(a, {
            book_id: book_id
        },
                function (b) {
                    if (b.flag === 1) {
                        $(".book-collect").addClass("active_sc")
                    }
                })
    }
}
function getRewardMoney() {
    var a = U("getRewardMoney");
    if (a) {
        ajaxPost(a, {
            book_id: book_id
        },
                function (b) {
                    var c = "本书已收到<em>" + b.money + "</em>元打赏，共" + b.people + "人打赏";
                    $("#reward-str").html(c)
                })
    }
}
function getSameBooks() {
    var a = U("getSameBooks");
    ajaxPost(a, {
        book_id: book_id
    },
            function (c) {
                if (c.list) {
                    var b = U("info");
                    var d = "";
                    $.each(c.list,
                            function (e, f) {
                                d += "<li>";
                                d += '<a href="' + b + "?book_id=" + f.id + '">';
                                d += "<div>";
                                d += '<img src="' + f.cover + '">';
                                d += "</div>";
                                d += "<h4>" + f.name + "</h4>";
                                d += "</a>";
                                d += "</li>"
                            });
                    if (d) {
                        $(".choicenessCount>ul").html(d);
                        $(".evaluation").show()
                    }
                }
            })
}
function rewardLayer() {
    layer.open({
        content: $(".ds_proup").html(),
        shadeClose: false,
        className: "layerPadding",
        style: "background-color:#fff; color:#fff; border:none;"
    })
}
function chooseRewardMoney(a) {
    $(a).addClass("active").siblings().removeClass("active")
}
function doReward() {
    var b = $(".layerPadding .reward_money .active").attr("data-val");
    var c = {
        money: b,
        relation_id: book_id,
        relation_type: book_type
    };
    var a = U("Charge/doReward");
    if (a) {
        ajaxPost(a, c,
                function (d) {
                    window.location.href = d.url
                })
    }
}
function toAttention() {
    layer.open({
        content: $(".attention_dom").html(),
        shadeClose: false,
        className: "chaseLayer",
        style: "background-color:#fff; color:#fff; border:none;    border-radius:20px ;"
    })
}
function getComments() {
    var a = U("Com/getComments");
    if (a) {
        ajaxPost(a, {
            pid: book_id,
            ptype: book_type
        },
                function (b) {
                    if (b.list) {
                        var c = "";
                        $.each(b.list,
                                function (d, e) {
                                    c += "<li>";
                                    c += '<div class="evaluationImg">';
                                    c += '<img src="' + e.headimgurl + '" alt="">';
                                    c += "</div>";
                                    c += '<div class="evaluationFont">';
                                    c += "<div>";
                                    c += "<h4>" + e.nickname + "</h4>";
                                    c += "<span>" + e.create_time + "</span>";
                                    c += "</div>";
                                    c += "<p>" + e.content + "</p>";
                                    c += "</div>";
                                    c += "</li>"
                                });
                        $(".evaluationList>ul").html(c)
                    } else {
                        $(".evaluationList>ul").html('<li style="text-align:center;font-size:1.3rem;">暂无评论</li>')
                    }
                    $("#commentNum").text("(" + b.count + ")")
                })
    }
}
$(function () {
    a();
    $(window).resize(function () {
        a()
    });
    function a() {
        var c = $("body").width();
        $(".footerBook").width(c)
    }
    var b = new Swiper(".swiperBook", {
        spaceBetween: 0,
        autoHeight: true,
        observer: true,
        observeParents: true,
    });
    $(".directoryNav>a").click(function () {
        var c = $(".directoryNav>a").index($(this));
        $(this).addClass("active").siblings().removeClass("active");
        b.slideTo(c, 1000, false)
    });
    if (is_dir == 1) {
        $(".directoryNav>a:eq(1)").click()
    }
});