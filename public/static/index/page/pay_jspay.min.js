function jsApiCall() {
    WeixinJSBridge.invoke('getBrandWCPayRequest', $paymsg,
    function(res) {
        if (res.err_msg == "get_brand_wcpay_request:ok") {
            layer.open({
                content: '支付成功',
                skin: 'msg',
                time: 1
            });
            setTimeout(function() {
                location.href = $backurl
            },
            1000)
        } else if (res.err_msg == "get_brand_wcpay_request:cancel") {
            $('.defeated').find('h3').text('支付失败');
            $('.defeated').find('img').attr('src', '/static/index/images/payDefeated.png');
            $('.pay-repay').show()
        } else {
            $('.defeated').find('h3').text('支付失败');
            $('.defeated').find('img').attr('src', '/static/index/images/payDefeated.png');
            $('.pay-repay').show()
        }
    })
}
function callpay() {
    if (typeof WeixinJSBridge == "undefined") {
        if (document.addEventListener) {
            document.addEventListener('WeixinJSBridgeReady', jsApiCall, false)
        } else if (document.attachEvent) {
            document.attachEvent('WeixinJSBridgeReady', jsApiCall);
            document.attachEvent('onWeixinJSBridgeReady', jsApiCall)
        }
    } else {
        jsApiCall()
    }
}
setTimeout(callpay, 500);