$(function() {
    var d = 1,
    c = false;
    b();
    a();
    $(window).resize(function() {
        b()
    });
    function b() {
        var i = $("body").width();
        $(".cartoonWapper").width(i - 20);
        $(".footer").width(i - 60);
        $(".bootomDetele").width(i);
        var j = $(".cartoonflex>a.active").innerWidth(),
        g = $(".cartoonflex>a.active").offset().left,
        h = $(".cartoonflex").offset().left;
        $(".historyLine").css({
            "width": j,
            "left": g - h
        })
    }
    $(".select_sc").click(function() {
        if (!$(this).hasClass("active")) {
            $(".scBox").css("marginLeft", 30);
            $(this).addClass("active");
            $(this).text("取消");
            $(".radiosSelect").addClass("activeScale");
            $(".bootomDetele").css("bottom", 50)
        } else {
            $(".scBox").css("marginLeft", 0);
            $(this).removeClass("active");
            $(this).text("选择");
            $(".radiosSelect").removeClass("activeScale");
            $(".bootomDetele").css("bottom", 0)
        }
        e()
    });
    $(".ripple").click(function() {
        var h = [];
        $('input[name="book"]:checked').each(function() {
            h.push($(this).val())
        });
        if (h.length == 0) {
            layMsg("您尚未选择要移除的书籍");
            return false
        }
        var g = U("delHistory");
        if (g) {}
        ajaxPost(g, {
            book_id: h
        },
        function() {
            $('input[name="book"]:checked').each(function() {
                $(this).parents("li").remove();
                e();
                f()
            })
        })
    });
    $("body").on("click", ".recommendList>ul>li .radiosSelect",
    function() {
        var i = $(this).children("input"),
        h = $(this).children("span");
        var g = $(".recommendList>ul>li .radiosSelect").index($(this));
        if (!$(this).hasClass("active")) {
            $(this).addClass("active");
            i.prop("checked", true)
        } else {
            $(this).removeClass("active");
            i.prop("checked", false)
        }
        e()
    });
    $(".allSelect").click(function() {
        var g = $(".recommendList>ul>li .radiosSelect");
        if (!$(this).hasClass("active")) {
            $(this).addClass("active");
            $("input[type=checkbox]").prop("checked", true);
            g.addClass("active");
            $(this).children("em").text("全不选")
        } else {
            $(this).removeClass("active");
            $("input[type=checkbox]").prop("checked", false);
            g.removeClass("active");
            $(this).children("em").text("全选")
        }
        e()
    });
    function e() {
        var g = $('input[name="book"]:checked').length;
        $(".bootomDetele .ripple").text("确定删除(" + g + ")")
    }
    function a() {
        if (!c) {
            c = true;
            ajaxPost("", {
                page: d
            },
            function(h) {
                var g = 0;
                if (h) {
                    $.each(h,
                    function(j, k) {
                        g++;
                        var l = "";
                        l += "<li>";
                        l += '<div class="radiosSelect">';
                        l += '<input type="checkbox" name="book" value="' + k.book_id + '"/>';
                        l += "<span></span>";
                        l += "</div>";
                        l += '<div class="scBox">';
                        l += '<div class="recommendPos">';
                        l += '<div class="recommendHotImg">';
                        l += '<a href="' + k.read_url + '"><img src="' + k.cover + '" alt=""></a>';
                        l += '<span><img src="/static/index/images/cartoonBf.png" alt=""></span>';
                        l += "</div>";
                        l += '<div class="recommendFont">';
                        l += '<h4 class="over">';
                        l += '<a href="' + k.read_url + '">' + k.name + "</a>";
                        l += "</h4>";
                        l += '<p class="over2">';
                        l += '<a href="' + k.read_url + '">' + k.summary + "</a>";
                        l += "</p>";
                        l += '<div class="historyTag">';
                        l += '<a class="active_wj">' + k.type + "</a>";
                        l += '<a class="active_wj">' + k.over_type + "</a>";
                        if (k.category) {
                            for (var j = 0; j < k.category.length; j++) {
                                l += '<a href="javascript:;" >' + k.category[j] + "</a>"
                            }
                        }
                        l += "</div>";
                        l += '<div class="historyNumber">';
                        l += "<div>";
                        l += "<span>";
                        l += '<img src="/static/index/images/cartoon_ico1.jpg" alt="">';
                        l += "<em>" + k.hot_num + "</em>";
                        l += "</span>";
                        l += "<span>";
                        l += '<img src="/static/index/images/cartoon_ico2.jpg" alt="">';
                        l += "<em>" + k.total_chapter + "章</em>";
                        l += "</span>";
                        l += "</div>";
                        l += '<a href="' + k.read_url + '">已读至第' + k.read_number + "章></a>";
                        l += "</div>";
                        l += "</div>";
                        l += "</div>";
                        l += "</div>";
                        l += "</li>";
                        $("#listBox").append(l)
                    });
                    if (!$(".select_sc").hasClass("activeX")) {
                        console.log(1);
                        $(".select_sc").addClass("activeX")
                    }
                }
                if (g < 10) {
                    f()
                } else {
                    d++;
                    c = false
                }
            })
        }
    }
    function f() {
        var g = $(".recommendList>ul>li").length;
        g = g > 0 ? g: 0;
        if (g === 0) {
            var h = "";
            h += '<div class="bookcase">';
            h += '<img src="/static/index/images/scTsImg.png" alt="">';
            h += "<p>您还没有历史记录哟！</p>";
            h += '<a href="/" class="ripple">去找几本漫画小说看看</a>';
            h += "</div>";
            $(".cartoonRecommend").css("background", "none");
            $(".recommendList").html(h)
        }
    }
    $(window).scroll(function() {
        var h = $(this).scrollTop();
        var g = $(document).height();
        var i = $(this).height();
        if (h + i == g) {
            if (!c) {
                a()
            }
        }
    })
});