var page = 1,
is_end = false;
getData();
$(window).scroll(function() {
    var b = $(this).scrollTop();
    var a = $(document).height();
    var c = $(this).height();
    if (b + c == a) {
        if (!is_end) {
            getData()
        }
    }
});
function getData() {
    if (!is_end) {
        is_end = true;
        data["page"] = page;
        ajaxPost("", data,
        function(b) {
            var a = 0;
            if (b.list) {
                var c = "";
                $.each(b.list,
                function(d, e) {
                    a++;
                    c += "<li>";
                    c += '<div class="evaluationImg">';
                    c += '<img src="' + e.headimgurl + '" alt="">';
                    c += "</div>";
                    c += '<div class="evaluationFont">';
                    c += "<div>";
                    c += "<h4>" + e.nickname + "</h4>";
                    c += "<span>" + e.create_time + "</span>";
                    c += "</div>";
                    c += "<p>" + e.content + "</p>";
                    c += "</div>";
                    c += "</li>"
                });
                if (c) {
                    $(".discussNo").hide();
                    $(".evaluationList").show();
                    $(".evaluationList>ul").append(c)
                }
            }
            if (page === 1) {
                $(".discussPl>p").text("评论共" + b.count + "条")
            }
            if (a >= 10) {
                page++;
                is_end = false
            }
        })
    }
}
function doComments() {
    var c = $("#content").val();
    if (c.length == 0) {
        layMsg("未检测到评论内容");
        return false
    }
    var b = data;
    b["content"] = c;
    var a = U("doComments");
    ajaxPost(a, b,
    function() {
        $("#content").val("");
        layMsg("发表成功，评论审核中...")
    })
}
$(function() {
    a();
    $(window).resize(function() {
        a()
    });
    function a() {
        var b = $("body").width();
        $(".discussBot").width(b)
    }
    $(".discussInput>div>input").focus(function() {
        var b = $("body").prop("scrollHeight");
        $("body").animate({
            scrollTop: b
        },
        400)
    });
    $(".discussInput>div>input").blur(function() {
        $("body").animate({
            scrollTop: 0
        },
        400)
    })
});