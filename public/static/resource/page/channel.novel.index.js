layui.use(["jquery","layer","table","form"],function(){var d=layui.jquery,a=layui.layer,c=layui.table,b=layui.form;layLoad("数据加载中...");c.render({elem:"#table-block",url:data_url,loading:true,cols:[[{title:"封面",minWidth:100,align:"center",templet:function(g){var f='<font class="text-red">暂无封面</font>';if(g.cover){f='<img src="'+g.cover+'" style="width:50px;" />'}return f}},{title:"小说名称",align:"center",minWidth:260,templet:function(g){var f=g.name+"&nbsp;";f+='<a class="layui-btn layui-btn-xs layui-btn-primary" lay-event="copy" title="点击复制链接"><i class="layui-icon layui-icon-link"></i></a>';return f}},{field:"author",title:"作者",align:"center",minWidth:120},{field:"total_chapter",title:"总章节",align:"center",minWidth:120},{field:"over_type",title:"进度",align:"center",minWidth:100},{field:"free_type",title:"属性",align:"center",minWidth:80},{field:"long_type",title:"篇幅",align:"center",minWidth:80},{field:"gender_type",title:"频道",align:"center",minWidth:80},{title:"操作",align:"center",minWidth:400,templet:function(h){var f="";var g=parseInt(h.book_id);if(g>0){f+='<a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="share">分享话术</a>'}f+='<a class="layui-btn layui-btn-normal layui-btn-xs" href="'+h.guide_url+'" target="_blank">生成文案</a>';f+='<a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="spread">推广链接</a>';f+='<a class="layui-btn layui-btn-normal layui-btn-xs" href="'+h.customer_url+'">客服消息</a>';return f}}]],page:true,height:"full-220",response:{statusCode:1},id:"table-block",done:function(f){a.closeAll()}});c.on("tool(table-block)",function(g){var f=g.data;switch(g.event){case"spread":e(f.spread_url);break;case"share":layPage("分享话术【"+f.name+"】",f.share_url,"800px","500px");break;case"copy":layPage("复制小说链接【"+f.name+"】",f.copy_url,"800px","500px");break}});function e(f){a.open({type:2,title:"生成推广链接",closeBtn:1,shade:[0],area:["800px","600px"],offset:"100px",time:0,anim:2,scrollbar:false,content:[f,"yes"],btn:["生成推广链接"],yes:function(j,h){var i=d(h).find("iframe")[0].contentWindow,g="pageSubmit",k=h.find("iframe").contents().find("#"+g);i.layui.form.on("submit("+g+")",function(m){var l=m.field;ajaxPost(f,l,"确定要生成推广链接吗？",function(n){layOk("生成成功");a.close(j);setTimeout(function(){window.location.href=spread_url},1000)})});k.trigger("click")}})}b.on("submit(table-search)",function(g){var f=g.field;layLoad("数据加载中...");c.reload("table-block",{where:f,page:{curr:1}})})});