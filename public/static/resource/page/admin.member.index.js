layui.use(["jquery","layer","table","form"],function(){var d=layui.jquery,a=layui.layer,c=layui.table,b=layui.form;layLoad("数据加载中...");c.render({elem:"#table-block",url:data_url,loading:true,cols:[[{title:"序号",type:"numbers"},{field:"id",title:"粉丝ID",align:"center",minWidth:120},{field:"channel_name",title:"所属渠道",align:"center",minWidth:120},{field:"agent_name",title:"所属代理",align:"center",minWidth:120},{field:"nickname",title:"粉丝昵称",align:"center",minWidth:120},{field:"phone",title:"绑定手机号",align:"center",minWidth:160},{title:"书币余额",align:"center",minWidth:130,templet:function(g){var f=g.money;f+="&nbsp;";f+='<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="charge">书币调整</a>';return f}},{field:"is_subscribe",title:"是否关注",align:"center",minWidth:100},{title:"VIP",align:"center",minWidth:260,templet:function(g){var f=g.vip_str+"&nbsp;";if(parseInt(g.viptime)>0){f+='<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="vipoff">取消vip</a>'}else{f+='<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="vipon">设置vip</a>'}return f}},{field:"create_time",title:"注册时间",align:"center",minWidth:200},{title:"用户状态",align:"center",minWidth:100,templet:function(h){var f=h.status_name+"&nbsp;";var g=parseInt(h.status);switch(g){case 1:f+='<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="statusoff">禁用</a>';break;case 2:f+='<a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="statuson">启用</a>';break}return f}},{title:"更多",align:"center",minWidth:120,templet:function(g){var f="";f+='<a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="info">查看详情</a>';return f}}]],page:true,height:"full-220",response:{statusCode:1},id:"table-block",done:function(f){a.closeAll()}});c.on("tool(table-block)",function(h){var g=h.data;var f={id:g.id,event:h.event};switch(h.event){case"charge":a.prompt({title:"书币调整（减少请填负数）",formType:0},function(j,i){a.close(i);f["money"]=j;ajaxPost(money_url,f,"确定要继续吗？",function(){layOk("调整成功");setTimeout(function(){layLoad("数据加载中...");c.reload("table-block")},1400)})});break;case"statuson":e("确定要启用该用户吗？",f);break;case"statusoff":e("确定要禁用该用户吗？",f);break;case"vipon":a.prompt({title:"vip设置（单位：月）",formType:0},function(j,i){a.close(i);f["month"]=j;ajaxPost(money_url,f,"确定要继续吗？",function(){layOk("设置成功");setTimeout(function(){layLoad("数据加载中...");c.reload("table-block")},1400)})});break;case"vipoff":ajaxPost(money_url,f,"确定要继续吗？",function(){layOk("取消成功");setTimeout(function(){layLoad("数据加载中...");c.reload("table-block")},1400)});break;case"info":layPage("用户详情",g.info_url,"90%","80%");break;default:layError("该按钮未绑定事件");break}});function e(g,f){ajaxPost(state_url,f,g,function(){layOk("操作成功");setTimeout(function(){layLoad("数据加载中...");c.reload("table-block")},1400)})}b.on("submit(table-search)",function(g){var f=g.field;layLoad("数据加载中...");c.reload("table-block",{where:f,page:{curr:1}})})});