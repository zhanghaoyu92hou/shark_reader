layui.use(["jquery","form"],function(){var $=layui.jquery,form=layui.form;var uplayer;form.on("submit(dosubmit)",function(obj){var data=obj.field;ajaxPost("",data,"确定要保存吗？",function(d){layOk("保存成功");setTimeout(function(){location.href=$backUrl},1000)})});changeFreeType($free_type);form.on("radio(free_type)",function(obj){var value=parseInt(obj.value);changeFreeType(value)});function changeFreeType(value){if(value==2){$(".free-input-line").removeClass("layui-hide")}else{$(".free-input-line").addClass("layui-hide")}}$("#doUpload").click(function(){$(".upload-loading").hide();$(".upload-remark").show();uplayer=layer.open({type:1,shade:false,title:"上传视频",shade:[0],offset:"100px",area:"630px",content:$(".zipLayer")})});var uploader=new plupload.Uploader({runtimes:"html5,flash,silverlight,html4",browse_button:"doneUpload",url:file_url,chunk_size:"500kb",save_key:true,multi_selection:false,flash_swf_url:"/static/plugins/plupload/Moxie.swf",silverlight_xap_url:"/static/plugins/plupload/Moxie.xap",filters:{max_file_size:"500mb",mime_types:[{title:"files",extensions:"mp4"}],prevent_duplicates:false},init:{FilesAdded:function(up,files){var str='<div class="upload-state-div"><span></span><font>文件上传中...</font></div>';$(".upload-loading").html(str);$(".upload-loading").show();$(".upload-remark").hide();uploader.start()},FileUploaded:function(up,file,info){var res=eval("("+info.response+")");if(res.code===1){layer.close(uplayer);layOk("处理成功");$("#video_url").val(res.data.url);$("#video_key").val(res.data.file_key)}else{var str='<div class="upload-state-div"><font class="text-red">'+res.msg+"</font></div>";$(".upload-loading").html(str)}},Error:function(up,err){layError("上传失败,请重试");$(".upload-loading").hide();$(".upload-remark").show()}}});uploader.init()});